<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Home | Buckup-Media</title>
  <link rel="stylesheet" href="./style.css?v=3">
</head>
<body class="adminShell">

  <aside class="sideNav">
    <div class="sideTop">
      <div class="sideLogo">BM</div>
      <div>
        <div class="sideName">Buckup-Media</div>
        <div class="sideSub">Dashboard</div>
      </div>
    </div>

    <nav class="sideMenu">
      <button class="navItem active">Home</button>
      <button class="navItem" id="navWallet">Wallet</button>
      <button class="navItem" id="navAccounts">Accounts</button>
      <button class="navItem" id="navTool">Data Duplicater</button>
      <button class="navItem" id="navAdmin">Admin</button>
    </nav>

    <div class="sideBottom">
      <div class="sideHint">Buckup-Media Portal</div>
      <div class="sideSmall">© Buckup-Media</div>
    </div>
  </aside>

  <div class="mainArea">
    <header class="topBar">
      <div>
        <div class="topTitle">Home</div>
        <div class="topSub">Welcome to your dashboard</div>
      </div>

      <div class="topRight">
        <span class="chip" id="verChip">Checking…</span>
        <button class="toolBtn ghost" id="logoutBtn">Logout</button>
      </div>
    </header>

    <main class="content">
      <section class="page show">

        <div class="dashGrid">
          <!-- Wallet Card -->
          <div class="dashCard walletGlow" id="walletCard" role="button" tabindex="0">
            <div class="dashCardTop">
              <div>
                <div class="dashLabel">Wallet</div>
                <div class="dashBig" id="walletBal">₹ —</div>
                <div class="dashSmall" id="walletSmall">Tap to open statement</div>
              </div>
              <div class="dashIcon">₹</div>
            </div>
            <div class="dashPills">
              <span class="miniPill">Bank-style statement</span>
              <span class="miniPill">CSV / TXT</span>
              <span class="miniPill">30-min deductions</span>
            </div>
          </div>

          <!-- Quick Actions -->
          <div class="dashCard">
            <div class="dashLabel">Quick actions</div>
            <div class="dashActions">
              <button class="toolBtn primary" id="goAccounts">Open Accounts</button>
              <button class="toolBtn ghost" id="goTool">Open Duplicater</button>
              <button class="toolBtn ghost" id="goProfile">My Profile</button>
            </div>
            <div class="toolHint" style="margin-top:10px;">
              Wallet credits are calculated by system (admin sets your rate).
            </div>
          </div>

          <!-- Stats dummy cards -->
          <div class="dashCard">
            <div class="dashLabel">Usage</div>
            <div class="dashStatRow">
              <div class="dashStat">
                <div class="dashStatK">This week</div>
                <div class="dashStatV">Active</div>
              </div>
              <div class="dashStat">
                <div class="dashStatK">Status</div>
                <div class="dashStatV">Verified</div>
              </div>
            </div>
            <div class="dashBar">
              <div class="dashBarFill" style="width:72%"></div>
            </div>
            <div class="dashSmall" style="margin-top:8px;">Dummy chart (UI only)</div>
          </div>
        </div>

      </section>
    </main>
  </div>

<script type="module">
  import { auth, db } from "./firebase.js";
  import { getSession, clearSession } from "./cache.js";
  import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const sess = getSession();
  if (!sess) location.href = "index.html";

  const verChip = document.getElementById("verChip");
  const walletBal = document.getElementById("walletBal");

  onAuthStateChanged(auth, async (user) => {
    if (!user) location.href = "index.html";
    if (!user.emailVerified) location.href = "index.html";
    verChip.textContent = "Verified";

    // show wallet balance preview (if wallet doc exists)
    try{
      const w = await getDoc(doc(db, "wallets", user.uid));
      const bal = w.exists() ? (w.data().balance || 0) : 0;
      walletBal.textContent = "₹ " + Number(bal).toLocaleString("en-IN");
    }catch{
      walletBal.textContent = "₹ —";
    }
  });

  // NAV
  document.getElementById("navAccounts").onclick = ()=> location.href = "accounts.html";
  document.getElementById("navTool").onclick = ()=> location.href = "dashboard.html";
  document.getElementById("navAdmin").onclick = ()=> location.href = "admin.html";

  // Wallet click: set flag so wallet.html plays coin sound
  function openWallet(){
    sessionStorage.setItem("bm_wallet_sound", "1");
    location.href = "wallet.html";
  }
  document.getElementById("navWallet").onclick = openWallet;
  const walletCard = document.getElementById("walletCard");
  walletCard.onclick = openWallet;
  walletCard.onkeydown = (e)=>{ if(e.key==="Enter" || e.key===" ") openWallet(); };

  // Quick actions
  document.getElementById("goAccounts").onclick = ()=> location.href = "accounts.html";
  document.getElementById("goTool").onclick = ()=> location.href = "dashboard.html";
  document.getElementById("goProfile").onclick = ()=> location.href = "account.html";

  // Logout
  document.getElementById("logoutBtn").onclick = async ()=>{
    await signOut(auth);
    clearSession();
    location.href = "index.html";
  };
</script>

</body>
</html>
