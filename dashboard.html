<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard | Buckup-Media</title>
  <link rel="stylesheet" href="./style.css">
</head>
<body>

<div class="card" style="max-width:720px">
  <div class="brand">Dashboard</div>
  <div class="sub" id="welcome">Loading...</div>

  <div class="btnRow">
    <button class="success" id="openSheet">Open Worksheet (Google Sheet)</button>
    <button class="ghost" id="goDuplicater">Go to Data Duplicater Page</button>
    <button class="ghost" id="logoutBtn">Logout</button>
  </div>

  <div id="er" class="msg err"></div>
</div>

<script type="module">
  import { auth, db } from "./firebase.js";
  import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
  import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const er = document.getElementById("er");
  const showEr = (t)=>{ er.style.display="block"; er.textContent=t; };

  let sheetLink = "";

  onAuthStateChanged(auth, async (user) => {
    if (!user) { window.location.href = "index.html"; return; }
    if (!user.emailVerified) { window.location.href = "index.html"; return; }

    try {
      const snap = await getDoc(doc(db, "users", user.uid));

      if (!snap.exists() || snap.data().profileCompleted !== true) {
        window.location.href = "profile.html";
        return;
      }

      const d = snap.data();
      sheetLink = d.googleSheetUrl || "";

      document.getElementById("welcome").textContent =
        "Welcome, " + (d.name || "User") + " âœ…";

    } catch (e) {
      showEr("Firestore error: " + (e.code || "") + " | " + (e.message || e));
      console.error(e);
    }
  });

  document.getElementById("openSheet").addEventListener("click", () => {
    if (!sheetLink) { alert("No Google Sheet link saved in profile."); return; }
    window.open(sheetLink, "_blank");
  });

  document.getElementById("goDuplicater").addEventListener("click", () => {
    // you can change this to your duplicater section page
    alert("Next: We will integrate Data Duplicater inside dashboard sidebar.");
  });

  document.getElementById("logoutBtn").addEventListener("click", async () => {
    await signOut(auth);
    window.location.href = "index.html";
  });
</script>

</body>
</html>
